<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI SQL Chatbot</title>
    <style>
        body {
          font-family: "Inter", sans-serif;
          background-color: #f5f6f8;
          margin: 0;
          display: flex;
          flex-direction: column;
          height: 100vh;
        }
        #chatContainer {
          flex: 1;
          overflow-y: auto;
          padding: 20px;
        }
        .bubble {
          max-width: 80%;
          padding: 12px 16px;
          margin: 8px 0;
          border-radius: 12px;
          white-space: pre-wrap;
          line-height: 1.5;
        }
        .user {
          align-self: flex-end;
          background-color: #0078ff;
          color: white;
          border-bottom-right-radius: 4px;
        }
        .bot {
          align-self: flex-start;
          background-color: white;
          border: 1px solid #ddd;
          border-bottom-left-radius: 4px;
        }
        #chatForm {
          display: flex;
          padding: 10px;
          background-color: white;
          border-top: 1px solid #ddd;
        }
        #messageInput {
          flex: 1;
          padding: 10px;
          border-radius: 8px;
          border: 1px solid #ccc;
          margin-right: 8px;
          font-size: 15px;
        }
        #sendBtn {
          background-color: #0078ff;
          color: white;
          border: none;
          padding: 10px 16px;
          border-radius: 8px;
          cursor: pointer;
        }
    </style>
    <!-- Load Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<div id="chatContainer"></div>

<form id="chatForm">
    <input id="messageInput" placeholder="Ask about your database..." required />
    <button id="sendBtn" type="submit">Send</button>
</form>

<script>
    const chatContainer = document.getElementById("chatContainer");
    const chatForm = document.getElementById("chatForm");
    const messageInput = document.getElementById("messageInput");

    function addMessage(text, sender) {
      const bubble = document.createElement("div");
      bubble.className = `bubble ${sender}`;
      if (sender === "bot") {
        // render markdown as HTML
        bubble.innerHTML = marked.parse(text);
      } else {
        bubble.textContent = text;
      }
      chatContainer.appendChild(bubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    chatForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const message = messageInput.value.trim();
      if (!message) return;
      addMessage(message, "user");
      messageInput.value = "";

      addMessage("‚è≥ Thinking...", "bot");
     const API_ENDPOINT = '/api/chat';
     const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json;charset=UTF-8',
                },
                body: JSON.stringify({ message }),
            });
      if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
      }

      const text = await response.text();

      // Remove "Thinking..." bubble and show real response
      chatContainer.lastChild.remove();
      addMessage(text, "bot");
    });
</script>
</body>
</html>
